<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WireGuard Config Files</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }

        h1 {
            margin-bottom: 20px;
        }

        .back {
            margin-bottom: 30px;
        }

        .back a {
            color: #666;
            text-decoration: none;
        }

        .back a:hover {
            text-decoration: underline;
        }

        ul {
            list-style: none;
            padding: 0;
        }

        li {
            margin: 10px 0;
        }

        a {
            display: block;
            padding: 12px 20px;
            background: #f5f5f5;
            text-decoration: none;
            color: #333;
            border-radius: 4px;
        }

        a:hover {
            background: #e0e0e0;
        }

        .conf {
            background: #e3f2fd;
        }

        .png {
            background: #f3e5f5;
        }
    </style>
</head>

<body>
    <div class="back"><a href="/">&larr; Back to all peers</a></div>
    <h1 id="title">Peer Config Files</h1>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin: 30px 0;">
        <div id="full-tunnel"></div>
        <div id="split-tunnel"></div>
    </div>

    <script>
        const path = window.location.pathname;
        const peerName = path.match(/peer\d+/)[0];
        document.getElementById('title').textContent = peerName.toUpperCase() + ' VPN Configs';

        function createConfigCard(title, subtitle, confFile, pngFile, containerId) {
            const container = document.getElementById(containerId);

            const heading = document.createElement('h2');
            heading.textContent = title;
            heading.style.marginBottom = '10px';
            heading.style.fontSize = '1.3em';
            container.appendChild(heading);

            const desc = document.createElement('p');
            desc.textContent = subtitle;
            desc.style.color = '#666';
            desc.style.marginBottom = '20px';
            container.appendChild(desc);

            if (pngFile) {
                const qrDiv = document.createElement('div');
                qrDiv.style.textAlign = 'center';
                qrDiv.style.marginBottom = '20px';

                const img = document.createElement('img');
                img.src = pngFile;
                img.style.maxWidth = '100%';
                img.style.border = '1px solid #ddd';
                img.style.borderRadius = '8px';
                img.style.padding = '20px';
                img.style.background = '#fff';
                qrDiv.appendChild(img);

                const caption = document.createElement('p');
                caption.textContent = 'Scan with mobile';
                caption.style.color = '#999';
                caption.style.marginTop = '10px';
                caption.style.fontSize = '0.9em';
                qrDiv.appendChild(caption);

                container.appendChild(qrDiv);
            }

            if (confFile) {
                const a = document.createElement('a');
                a.href = confFile;
                a.textContent = 'üìÑ Download Config';
                a.download = confFile;
                a.style.display = 'block';
                a.style.padding = '12px 20px';
                a.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                a.style.color = 'white';
                a.style.textDecoration = 'none';
                a.style.borderRadius = '8px';
                a.style.textAlign = 'center';
                a.style.fontWeight = '500';
                container.appendChild(a);
            }
        }

        fetch(path + '_list')
            .then(r => r.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const links = doc.querySelectorAll('a[href]');

                let fullConf = null, fullPng = null;
                let splitConf = null, splitPng = null;

                links.forEach(link => {
                    const href = link.getAttribute('href');
                    if (href === peerName + '.conf') fullConf = href;
                    else if (href === peerName + '.png') fullPng = href;
                    else if (href === peerName + '-split.conf') splitConf = href;
                    else if (href === peerName + '-split.png') splitPng = href;
                });

                if (fullConf || fullPng) {
                    createConfigCard(
                        'üåç Full Tunnel',
                        'All traffic routed through VPN',
                        fullConf, fullPng, 'full-tunnel'
                    );
                }

                if (splitConf || splitPng) {
                    createConfigCard(
                        'üè† Split Tunnel',
                        'Only LAN traffic through VPN',
                        splitConf, splitPng, 'split-tunnel'
                    );
                }
            });
    </script>
</body>

</html>