<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WireGuard Config Files</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }

        h1 {
            margin-bottom: 20px;
        }

        .back {
            margin-bottom: 30px;
        }

        .back a {
            color: #666;
            text-decoration: none;
        }

        .back a:hover {
            text-decoration: underline;
        }

        ul {
            list-style: none;
            padding: 0;
        }

        li {
            margin: 10px 0;
        }

        a {
            display: block;
            padding: 12px 20px;
            background: #f5f5f5;
            text-decoration: none;
            color: #333;
            border-radius: 4px;
        }

        a:hover {
            background: #e0e0e0;
        }

        .conf {
            background: #e3f2fd;
        }

        .png {
            background: #f3e5f5;
        }
    </style>
</head>

<body>
    <div class="back"><a href="/">&larr; Back to all peers</a></div>
    <h1 id="title">Peer Config Files</h1>
    <div id="qr-container" style="text-align: center; margin: 30px 0;"></div>
    <ul id="files"></ul>
    <script>
        const path = window.location.pathname;
        const peerName = path.match(/peer\d+/)[0];
        document.getElementById('title').textContent = peerName.toUpperCase() + ' Config';

        fetch(path + '_list')
            .then(r => r.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const links = doc.querySelectorAll('a[href]');
                const qrContainer = document.getElementById('qr-container');
                const ul = document.getElementById('files');

                let pngFile = null;
                let confFile = null;

                links.forEach(link => {
                    const href = link.getAttribute('href');
                    if (href.endsWith('.png')) {
                        pngFile = href;
                    } else if (href.endsWith('.conf')) {
                        confFile = href;
                    }
                });

                // Show QR code inline
                if (pngFile) {
                    const img = document.createElement('img');
                    img.src = pngFile;
                    img.style.maxWidth = '400px';
                    img.style.border = '1px solid #ddd';
                    img.style.borderRadius = '8px';
                    img.style.padding = '20px';
                    img.style.background = '#fff';
                    qrContainer.appendChild(img);

                    const caption = document.createElement('p');
                    caption.textContent = 'Scan with your mobile device';
                    caption.style.color = '#666';
                    caption.style.marginTop = '10px';
                    qrContainer.appendChild(caption);
                }

                // Show conf file as download button
                if (confFile) {
                    const li = document.createElement('li');
                    const a = document.createElement('a');
                    a.href = confFile;
                    a.className = 'conf';
                    a.textContent = 'ðŸ“„ Download Configuration File';
                    a.download = confFile;
                    li.appendChild(a);
                    ul.appendChild(li);
                }
            });
    </script>
</body>

</html>